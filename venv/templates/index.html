<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
    <link rel="stylesheet" href="../static/main.css">
</head>


    <nav class="navbar navbar-expand-lg navbar-light bg-dark text-light">
        <div class="container">
            <h1>Data Dogs</h1>
            <a href="/compare"><h4>compare</h4></a>
            <a href="/cluster"><h4>cluster</h4></a>
        </div>
        
        
    </nav>

    <div class="container"></div>
    <div class="jumbotron">
        <div class="container">
            <h2>About:</h2>
            <ul>
                <li>The dataset</li>
                <li>
                    z-standardized measures
                </li>
                <li>Blah blah blah</li>
            </ul>

            <div class="d-flex m-2">
                <form action="/compare" method="POST">
                    <h5>Two country comparison: </h5>
                    <select name="compareA" id="compareA" onchange="">
                        <option value="none"> --- </option>
                        {% for country in data_obj %}
                            
                            <option value="{{ country[0] }}">{{ country[0] }}</option>
                            

                        {% endfor %}
        
                    </select>
                    <select name="compareB" id="compareB" onchange="">
                        <option value="none"> --- </option>
                        {% for country in data_obj %}
                            
                            <option value="{{ country[0] }}">{{ country[0] }}</option>
                            

                        {% endfor %}
        
                    </select>
                    <input class="btn btn-dark" type="submit" value="Compare">

                    <!-- <button onclick='compare()' type="button" class="btn btn-dark">Compare</button> -->
                </form>
            </div>

            <div class="">
                <h1>Overview</h1>
                
                Select country: <select name="country" id="country" onchange="if(this.selectedIndex!=0)
                self.location=this.options[this.selectedIndex].value">
                    <option value="none"> --- </option>
                    {% for country in data_obj %}
                        
                        <option value="#{{ country[0] }}">{{ country[0] }}</option>
                        

                    {% endfor %}
    
                </select>
            </div>
            
        </div>
        
    </div>
    
    <div class="overview container">
    
    {% for country in data_obj %}
    
    
        <div class="container  overview-elem" id={{ country[0] }}>
            <h2>{{ country[0] }}</h2>
            <div class="container stats-table">
                <h4>Stats for {{ country[0] }}:</h4>
                <table class="table">
                    <tr>
                        <th>Sex</th><th>harm</th><th>fair</th><th>ingroup</th><th>auth</th><th>purity</th>
                    </tr>
                    <tr>
                        <td>female</td>
                        <td id={{ country[0] + "-f-harm" }}>{{ country[1].loc["female", "harm"] }}</td>
                        <td id={{ country[0] + "-f-fair" }}>{{ country[1].loc["female", "fair"] }}</td>
                        <td id={{ country[0] + "-f-ingroup" }}>{{ country[1].loc["female", "ingroup"] }}</td>
                        <td id={{ country[0] + "-f-auth" }}>{{ country[1].loc["female", "auth"] }}</td>
                        <td id={{ country[0] + "-f-purity" }}>{{ country[1].loc["female", "purity"] }}</td>
                    </tr>
                    <tr>
                        <td>male</td>
                        <td id={{ country[0] + "-m-harm" }}>{{ country[1].loc["male", "harm"] }}</td>
                        <td id={{ country[0] + "-m-fair" }}>{{ country[1].loc["male", "fair"] }}</td>
                        <td id={{ country[0] + "-m-ingroup" }}>{{ country[1].loc["male", "ingroup"] }}</td>
                        <td id={{ country[0] + "-m-auth" }}>{{ country[1].loc["male", "auth"] }}</td>
                        <td id={{ country[0] + "-m-purity" }}>{{ country[1].loc["male", "purity"] }}</td>
                    </tr>
                </table> 
            </div>
            
    
    
            <div class="">
                <div onclick="show_stats( {{ country[0] }} )" class="card dawg container m-0" id={{country[0] + "-f-glyph"}} style="display:grid;grid-template-rows:60% 40%; grid-template-columns:60% 40%;height:full;">
                    <h4>Female:</h4>
                </div>
                    
                
                <div onclick="show_stats( {{ country[0] }} )" class="card dawg container m-0" id={{country[0] + "-m-glyph"}} style="display:grid;grid-template-rows:60% 40%; grid-template-columns:60% 40%;height:full;">
                    <h4>Male:</h4>
                </div>
            </div>
            
                
        
        </div>
    
    {% endfor %}
    </div>
    
    </div>

<!-- <script src="../static/draw.js"></script> -->
<script>
// var countryA;
// var countryB;

// function set_compare_a(a){countryA = a}
// function set_compare_b(b){countryB = b}

// function compare(){
//     if (countryA && countryB){
//         // console.log(countryA + ", " + countryB);

//     }
    
// }

function clear_popups(){
    if (document.body.getElementsByClassName('popup')[0] != null){
        popup = document.body.getElementsByClassName('popup');
        // console.log(popup[0]);
        document.body.removeChild(popup[0]);
    }
}

// window.addEventListener('click', (event) => {
//     if (!event.target.classList.contains('popup')){
//         if (!event.target.classList.contains('dawg')){
//             clear_popups();
//         }
//     }
// })



function show_stats(country){
    clear_popups();
    console.log(country.children[1]);
    nodeContent = country.children[1].innerHTML;
    newnode = document.createElement('div');
    newnode.classList.add('card');
    newnode.classList.add('popup');
    newnode.innerHTML += "<p onclick='clear_popups()' style='text-align:right;cursor:pointer; margin:0px; padding: 0px;'>x<p>"
    newnode.innerHTML += nodeContent;
    newnode.style = 'padding: 20px; position: fixed; top: 10%; left: 30%; display: inline; background: white;';
    document.body.appendChild(newnode);
    newnode.style.animation = 'fillout .2s linear';
}

function gen_html (harm, fair, auth, ingroup, purity, sex) {
    const widthVar = 1.5*purity;
    const heightVar = 5 + 2.5*fair;
    const earHieght = ingroup == 0 ? 7 : 8*(ingroup);

    const happiness = -2.5*auth;
    const harmvar = harm;
    if (sex == "f"){sex = "red"}else{sex="blue"}

    newpath = `
        M 0,0 
        C ${-widthVar},30 ${-widthVar},50 0,80 
        C 30,${80 + heightVar} 50,${80 + heightVar} 80,80 
        C ${80 + widthVar},50 ${80 + widthVar},30 80,0 
        C 50,${-heightVar} 30,${-heightVar} 0,0 

        M 0,80 
        C 0,${80 + earHieght/3} 0,${80 + 2*(earHieght/3)} 10,${ 80 + earHieght} 
        C 20,${80 + 2*(earHieght/3)} 20,${80 + (earHieght/3)} 30,${80 - heightVar/(earHieght + 1)} 

        M 80,80 

        C 80,${80 + earHieght/3} 80,${80 + 2*(earHieght/3)} 70,${80 + earHieght}
        C 60,${80 + 2*(earHieght/3)} 60,${80 + (earHieght/3)} 50,${80 - heightVar/(earHieght + 1)}

        M 20,50
        C 23,55 28,55 30,50
        C 28,45 23,45 20,50

        M 60,50
        C 58,55 53,55 50,50
        C 53,45 58,45 60,50

        M 45,40
        L 35,40
        L 40,35
        L 45,40

        M 65,25
        C 50,${25 - happiness} 30,${25 - happiness} 15,25

        M 30,60
        L 15,${60 - harmvar}

        M 50,60
        L 65,${60 - harmvar}
    `
    
    return `<svg style="grid-area:2/2;overflow:visible;" ><path fill="white" stroke="${sex}" stroke-width="3" d="${newpath}" transform="rotate(180)">
</svg>`;
}

function draw_glyphs(){
    countries = ['Australia', 'Belgium', 'China', 'France', 'Hungary', 'Iran', 'Japan', 'Korea', 'Latvia', 'Mongolia', 'Netherlands', 'Poland', 'Russia', 'Serbia', 'Spain', 'Sweden', 'Turkey', 'UK', 'US']
    //countries = ["Russia", "Sweden", "Mongolia", "US", "Australia", "Spain", "Iran"]
    for (var i = 0; i < countries.length; i++) {
        
        var glyphF = document.getElementById(`${countries[i]}-f-glyph`);
        var glyphM = document.getElementById(`${countries[i]}-m-glyph`);
        
        var f_data = {
            "harm": Number(document.getElementById(`${countries[i]}-f-harm`).innerText),
            "fair": Number(document.getElementById(`${countries[i]}-f-fair`).innerText),
            "auth": Number(document.getElementById(`${countries[i]}-f-auth`).innerText),
            "ingroup": Number(document.getElementById(`${countries[i]}-f-ingroup`).innerText),
            "purity": Number(document.getElementById(`${countries[i]}-f-purity`).innerText)
        }
        var m_data = {
            "harm": Number(document.getElementById(`${countries[i]}-m-harm`).innerText),
            "fair": Number(document.getElementById(`${countries[i]}-m-fair`).innerText),
            "auth": Number(document.getElementById(`${countries[i]}-m-auth`).innerText),
            "ingroup": Number(document.getElementById(`${countries[i]}-m-ingroup`).innerText),
            "purity": Number(document.getElementById(`${countries[i]}-m-purity`).innerText)
        }
        console.log(countries[i])
        glyphF.innerHTML += gen_html(f_data.harm, f_data.fair, f_data.auth, f_data.ingroup, f_data.purity,"f");
        glyphM.innerHTML += gen_html(m_data.harm, m_data.fair, m_data.auth, m_data.ingroup, m_data.purity,"m");
    }
}    


draw_glyphs();

</script>

